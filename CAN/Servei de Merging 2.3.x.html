<html>
    <head>
        <title>Canigó - Espai Privat : Servei de Merging 2.3.x</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Canigó - Espai Privat : Servei de Merging 2.3.x
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Mar 18, 2009 by <font color="#0050B2">manel.batlles</font>.
				    </div>

				    <h1><a name="ServeideMerging2.3.x-SERVEIDEMERGING"></a>SERVEI DE MERGING</h1>

<div>
<ul><a href='#ServeideMerging2.3.x-SERVEIDEMERGING'>
    <li>SERVEI DE MERGING</li></a><a href='#ServeideMerging2.3.x-Introducci%C3%B3'>
    <li>Introducció</li></a>
<ul><a href='#ServeideMerging2.3.x-Prop%C3%B2sit'>
    <li>Propòsit</li></a><a href='#ServeideMerging2.3.x-ContextiEscenarisd%27%C3%9As'>
    <li>Context i Escenaris  d'Ús</li></a><a href='#ServeideMerging2.3.x-VersionsiDepend%C3%A8ncies'>
    <li>Versions i  Dependències</li></a><a href='#ServeideMerging2.3.x-Aquivadirigit'>
    <li>A qui va dirigit</li></a><a href='#ServeideMerging2.3.x-DocumentsiFontsdeRefer%C3%A8ncia'>
    <li>Documents i  Fonts de Referència</li></a>
</ul><a href='#ServeideMerging2.3.x-Descripci%C3%B3Detallada'>
    <li>Descripció  Detallada</li></a>
<ul><a href='#ServeideMerging2.3.x-ArquitecturaiComponents'>
    <li>Arquitectura i Components</li></a><a href='#ServeideMerging2.3.x-Instal.laci%C3%B3iConfiguraci%C3%B3'>
    <li>Instal.lació  i Configuració</li></a>
<ul><a href='#ServeideMerging2.3.x-Instal.laci%C3%B3'>
    <li>Instal.lació</li></a><a href='#ServeideMerging2.3.x-Configuraci%C3%B3'>
    <li>Configuració</li></a>
</ul><a href='#ServeideMerging2.3.x-Utilitzaci%C3%B3delServei'>
    <li>Utilització del  Servei</li></a>
<ul><a href='#ServeideMerging2.3.x-Integraci%C3%B3ambelServeiMultiidiomaiExcepcions'>
    <li>Integració  amb el Servei Multiidioma i Excepcions</li></a>
</ul>
</ul><a href='#ServeideMerging2.3.x-Exemple'>
    <li>Exemple</li></a>
</ul></div>

<h1><a name="ServeideMerging2.3.x-Introducci%C3%B3"></a>Introducció</h1>

<h2><a name="ServeideMerging2.3.x-Prop%C3%B2sit"></a>Propòsit</h2>

<p>Aquest servei permet aplicar un conjunt de canvis definits per un diccionari sobre un document en format WordML.</p>

<p>Es parteix d'un document que conté un o més marcadors que han de ser substituits i d'un conjunt de diccionaris de substitució.</p>

<p>Per cada un dels diccionaris de substitució, el servei de merging realitza la substitució de cada marcador pel valor indicat en el diccionari i el resultat és un nou document, també en format WordML.</p>

<p>Els marcadors consisteixen en una marca d'inici, un texte-clau i una marca de final.</p>

<p>Per exemple, si el document WordML conté el texte "En un lugar de la @@cosa## y tal.", les marques d'inici i final s'han definit com "@@" i "##" respectivament i el diccionari conté la entrada ("cosa", "Mancha") llavors en el document WordML resultant el texte s'haurà convertit en "En un lugar de la Mancha y tal."</p>

<h2><a name="ServeideMerging2.3.x-ContextiEscenarisd%27%C3%9As"></a>Context i Escenaris  d'Ús</h2>

<h2><a name="ServeideMerging2.3.x-VersionsiDepend%C3%A8ncies"></a>Versions i  Dependències</h2>

<h2><a name="ServeideMerging2.3.x-Aquivadirigit"></a>A qui va dirigit</h2>

<p>Aquest document va dirigit als següents perfils:</p>
<ol>
	<li>Programador. Per conéixer l'ús del servei</li>
	<li>Arquitecte. Per conéixer quins són els components i la configuració del servei</li>
	<li>Administrador. Per conéixer com configurar el servei en cadascun dels  entorns en cas de necessitat</li>
</ol>


<h2><a name="ServeideMerging2.3.x-DocumentsiFontsdeRefer%C3%A8ncia"></a>Documents i  Fonts de Referència</h2>

<h1><a name="ServeideMerging2.3.x-Descripci%C3%B3Detallada"></a>Descripció  Detallada</h1>

<h2><a name="ServeideMerging2.3.x-ArquitecturaiComponents"></a>Arquitectura i Components</h2>

<p>Els components podem classificar-los en:</p>
<ol>
	<li>Interfícies i Components Genérics. Interfícies del servei i components d'ús  general amb independència de la implementació escollida.</li>
	<li>Implementació basada en Spring</li>
</ol>


<h2><a name="ServeideMerging2.3.x-Instal.laci%C3%B3iConfiguraci%C3%B3"></a>Instal.lació  i Configuració</h2>

<h3><a name="ServeideMerging2.3.x-Instal.laci%C3%B3"></a>Instal.lació</h3>

<p>La instal.lació del servei requereix de la utilització de la llibreria 'canigo-services-merging' i les seves dependències.</p>

<h3><a name="ServeideMerging2.3.x-Configuraci%C3%B3"></a>Configuració</h3>

<p>La configuració del servei implica els següents pasos:</p>

<ol>
	<li>Definir la implementació del Servei que s'usarà</li>
	<li>Definir la localització del fitxer de propietats del Servei</li>
	<li>Definir les propietats del Servei</li>
</ol>


<p><b>Definició del Servei</b></p>

<p><em>Fitxer de configuració: canigo-services-merging.xml</em></p>

<p><em>Ubicació proposada:  &lt;PROJECT_ROOT&gt;/src/main/resources/spring</em></p>

<p>En aquest apartat configurarem el bean de Servei de Merging, és a dir, la implementació que es farà servir en l'atribut 'class'. En l'actualitat s'ofereix  la classe 'net.gencat.ctti.canigo.services.merging.impl.MergeTemplateXMLEngineImpl'</p>

<div class="code"><div class="codeContent">
<pre class="code-java">&lt;bean id=<span class="code-quote">"mergeService"</span>
      class=<span class="code-quote">"net.gencat.ctti.canigo.services.merging.impl.MergeTemplateXMLEngineImpl"</span>&gt;
...
&lt;/bean&gt;</pre>
</div></div>

<p>Podem definir les següents propietats:</p>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> <b>Propietat</b> </th>
<th class='confluenceTh'> <b>Requerit</b> </th>
<th class='confluenceTh'> <b>Descripció</b> </th>
</tr>
<tr>
<td class='confluenceTd'> logService </td>
<td class='confluenceTd'> Si </td>
<td class='confluenceTd'> Referència al Servei de Traces </td>
</tr>
<tr>
<td class='confluenceTd'> iniciBookmark </td>
<td class='confluenceTd'> Sí </td>
<td class='confluenceTd'> Marca d'inici del texte a substituir (2 caràcters) </td>
</tr>
<tr>
<td class='confluenceTd'> fiBookmark </td>
<td class='confluenceTd'> Sí </td>
<td class='confluenceTd'>  Marca de final del texte a substituir (2 caràcters) </td>
</tr>
</tbody></table>

<p>Exemple:</p>

<div class="code"><div class="codeContent">
<pre class="code-java">&lt;bean id=<span class="code-quote">"mergeService"</span>
      class=<span class="code-quote">"net.gencat.ctti.canigo.services.merging.impl.MergeTemplateXMLEngineImpl"</span>&gt;
    &lt;property name=<span class="code-quote">"logService"</span> ref=<span class="code-quote">"loggingService"</span>&gt;&lt;/property&gt;
    &lt;property name=<span class="code-quote">"iniciBookmark"</span> value=<span class="code-quote">"@@"</span>&gt;&lt;/property&gt;
    &lt;property name=<span class="code-quote">"fiBookmark"</span> value=<span class="code-quote">"##"</span>&gt;&lt;/property&gt;
&lt;/bean&gt;</pre>
</div></div>

<h2><a name="ServeideMerging2.3.x-Utilitzaci%C3%B3delServei"></a>Utilització del  Servei</h2>

<p>A partir del bean mergeService, la utilització del servei consisteix en cridar el mètode mergeTemplate(InputStream pTemplate, List pDades) amb els paràmetres corresponents.</p>

<p>El primer paràmetre (pTemplate) és un InputStream amb el document WordML a processar.</p>

<p>El segon paràmetre (pDades) és un ArrayList que conté els diccionaris de traducció (HashMaps)</p>

<p>El resultat (de tipus ByteArrayOutputStream[]) conté un ByteArrayOutputStream per cada un dels elements de l'ArrayList pDades, amb el document ja processat.</p>

<h3><a name="ServeideMerging2.3.x-Integraci%C3%B3ambelServeiMultiidiomaiExcepcions"></a>Integració  amb el Servei Multiidioma i Excepcions</h3>

<p>El servei llença vàries excepcions amb codis per tal que el missatge pugui ser internacionalitzat. </p>

<p>Els codis generats son</p>

<p>net.gencat.ctti.canigo.services.merging.wrongXML : l'arxiu d'entrada no te el format WordML<br/>
net.gencat.ctti.canigo.services.merging.gral : problemes en la interpretació de l'arxiu o la generació del document amb el resultat.</p>

<h1><a name="ServeideMerging2.3.x-Exemple"></a>Exemple</h1>

<div class="code"><div class="codeContent">
<pre class="code-java"><span class="code-keyword">public</span> class MergeServiceTest <span class="code-keyword">extends</span> TestCase {
  <span class="code-keyword">private</span> MergeTemplateEngine mergeTemplateEngine;

  ...	
	
  <span class="code-keyword">public</span> void testMerge() <span class="code-keyword">throws</span> Exception {
    mergeTemplateEngine.mergeTemplate(<span class="code-keyword">null</span>, <span class="code-keyword">null</span>);
    InputStream is = <span class="code-object">Thread</span>.currentThread().getContextClassLoader().getResourceAsStream(<span class="code-quote">"TestDoc.xml"</span>);

    ArrayList dades = <span class="code-keyword">new</span> ArrayList();
    HashMap itemsMap = <span class="code-keyword">new</span> HashMap();
    itemsMap.put(<span class="code-quote">"cosa"</span>, <span class="code-quote">"Mancha"</span>);
    itemsMap.put(<span class="code-quote">"marca"</span>, <span class="code-quote">"Funciona"</span>);
    dades.add(itemsMap);

    ByteArrayOutputStream[] os = mergeTemplateEngine.mergeTemplate(is, dades);

    ...

  }
}</pre>
</div></div>


				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="border/border_bottom.gif"><img src="border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Apr 14, 2015 09:28</font></td>
		    </tr>
	    </table>
    </body>
</html>