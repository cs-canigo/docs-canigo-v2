<html>
    <head>
        <title>Canigó - Servei de Connexió amb PSIS</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Canigó - Servei de Connexió amb PSIS
                                                    </span>
				    </div>
			
				    <h1><a name="ServeideConnexi%C3%B3ambPSIS-Connexi%C3%B3ambPSIS"></a>Connexió amb PSIS</h1>


<h1><a name="ServeideConnexi%C3%B3ambPSIS-%C3%8Dndex"></a>Índex</h1>

<p><br clear="all" />
<div>
<ul><a href='#ServeideConnexi%C3%B3ambPSIS-Connexi%C3%B3ambPSIS'>
    <li>Connexió amb PSIS</li></a><a href='#ServeideConnexi%C3%B3ambPSIS-%C3%8Dndex'>
    <li>Índex</li></a>
<ul><a href='#ServeideConnexi%C3%B3ambPSIS-Prop%C3%B2sit'>
    <li>Propòsit</li></a><a href='#ServeideConnexi%C3%B3ambPSIS-Funcionalitatsdelconnector'>
    <li>Funcionalitats del connector</li></a><a href='#ServeideConnexi%C3%B3ambPSIS-VersionsiDepend%C3%A8ncies'>
    <li>Versions i Dependències</li></a><a href='#ServeideConnexi%C3%B3ambPSIS-Instal.laci%C3%B3iConfiguraci%C3%B3'>
    <li>Instal.lació i Configuració</li></a>
<ul><a href='#ServeideConnexi%C3%B3ambPSIS-Instal.laci%C3%B3'>
    <li>Instal.lació</li></a><a href='#ServeideConnexi%C3%B3ambPSIS-Configuraci%C3%B3'>
    <li>Configuració</li></a>
<ul><a href='#ServeideConnexi%C3%B3ambPSIS-Configuraci%C3%B3delconnectordelaPICA'>
    <li>Configuració del connector de la PICA</li></a><a href='#ServeideConnexi%C3%B3ambPSIS-Definici%C3%B3delserveidePsis'>
    <li>Definició del servei de Psis</li></a>
</ul>
</ul><a href='#ServeideConnexi%C3%B3ambPSIS-Utilitzaci%C3%B3delServei'>
    <li>Utilització del Servei</li></a>
</ul><a href='#ServeideConnexi%C3%B3ambPSIS-Exemples'>
    <li>Exemples</li></a>
</ul></div><br clear="all" />
<br clear="all" />
<br clear="all" /></p>
<h2><a name="ServeideConnexi%C3%B3ambPSIS-Prop%C3%B2sit"></a>Propòsit</h2>

<p>El connector de PSIS de Canigó exposa totes les operacións publicades pel producte PSIS de la PICA.<br/>
Aquest mòdul permet consumir els diferents serveis que ofereix la plataforma de Psis mitjançant la PICA. El mòdul permet consumir els serveis oferts pels WebService amb peticions síncrones.</p>

<h2><a name="ServeideConnexi%C3%B3ambPSIS-Funcionalitatsdelconnector"></a>Funcionalitats del connector</h2>

<p>El connector proporciona accés a les següents operacions de Psis:</p>

<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Operació PSIS <br clear="all" /> </th>
<th class='confluenceTh'> Descripció Funcional <br clear="all" /> </th>
<th class='confluenceTh'> Modalitat PICA <br clear="all" /> </th>
<th class='confluenceTh'> Operació PICA <br clear="all" /> </th>
</tr>
<tr>
<td class='confluenceTd'> validarCertificat </td>
<td class='confluenceTd'> Avalua la validesa d'un certificat digital. També retorna informació sobre l'estat i altres dades utils del certificat. </td>
<td class='confluenceTd'> PSIS_VAL_CERT_SIMP </td>
<td class='confluenceTd'> TIPUS_VALIDAR_CERTIFICAT </td>
</tr>
<tr>
<td class='confluenceTd'> validarPDF </td>
<td class='confluenceTd'> Valida la integritat de la signatura d'un document PDF. </td>
<td class='confluenceTd'> PSIS_VAL_ATT_PDF </td>
<td class='confluenceTd'> TIPUS_VALIDAR_PDF </td>
</tr>
<tr>
<td class='confluenceTd'> validarSignatura (Fitxer)</td>
<td class='confluenceTd'> Valida matemàticament la signatura digital d'un fitxer mitjançant la certificat digital. També comprova l'estat del certificat en el moment de la signatura. </td>
<td class='confluenceTd'> PSIS_VAL_DET_FITXER </td>
<td class='confluenceTd'> TIPUS_VALIDAR_SIGNATURA </td>
</tr>
<tr>
<td class='confluenceTd'> validarSignatura (Hash)</td>
<td class='confluenceTd'> Comprova la validesa de la signtura digital mitjançant el hash del certificat. </td>
<td class='confluenceTd'> PSIS_VAL_DET_HASH </td>
<td class='confluenceTd'> TIPUS_VALIDAR_SIGNATURA <br clear="all" /> </td>
</tr>
</tbody></table>

<h2><a name="ServeideConnexi%C3%B3ambPSIS-VersionsiDepend%C3%A8ncies"></a>Versions i Dependències</h2>

<p>Les dependències descrites a la següent url són requerides per tal de compilar i fer funcionar el projecte:<br/>
Javadoc: <a href="http://canigo.ctti.gencat.cat/repository/maven2/canigo/connectors/canigo-connectors-psis/1.0.1-SNAPSHOT/" title="Visit page outside Confluence">http://canigo.ctti.gencat.cat/repository/maven2/canigo/connectors/canigo-connectors-psis/1.0.1-SNAPSHOT/</a><br/>
Site: <a href="http://canigo.ctti.gencat.net/confluence/canigodocs/site/canigo2_3_13/canigo-connectors-root/canigo-connectors-psis-pica/project-info.html" title="Visit page outside Confluence">http://canigo.ctti.gencat.net/confluence/canigodocs/site/canigo2_3_13/canigo-connectors-root/canigo-connectors-psis-pica/project-info.html</a></p>


<h2><a name="ServeideConnexi%C3%B3ambPSIS-Instal.laci%C3%B3iConfiguraci%C3%B3"></a>Instal.lació i Configuració</h2>

<h3><a name="ServeideConnexi%C3%B3ambPSIS-Instal.laci%C3%B3"></a>Instal.lació</h3>

<p>La instal.lació del servei requereix de la utilització de la llibreria 'canigo-services-psis' i les dependències indicades a l'apartat 'Introducció - Versions i Dependències'.</p>

<h3><a name="ServeideConnexi%C3%B3ambPSIS-Configuraci%C3%B3"></a>Configuració</h3>

<p>La configuració del Servei de PSIS implica:</p>
<ul>
	<li>Configurar el connector de la PICA.</li>
</ul>


<ul>
	<li>Definir el servei de Psis
<h4><a name="ServeideConnexi%C3%B3ambPSIS-Configuraci%C3%B3delconnectordelaPICA"></a>Configuració del connector de la PICA</h4></li>
</ul>


<p>S'han de crear els beans Requeridor i PicaServiceWrapper en el contexte de Spring <b>src/main/resources/spring/canigo-connectors.xml</b> com s'indica a continuació.
<br clear="all" />
<div class="code"><div class="codeContent">
<pre class="code-java">&lt;!-- CONNECTOR A PSIS --&gt;
    &lt;!-- Aquest connector és necessari per a utilitzar el servei de psis--&gt;
    &lt;bean id=<span class="code-quote">"requeridor"</span> class=<span class="code-quote">"cat.gencat.pica.peticio.core.beans.Requeridor"</span> singleton=<span class="code-quote">"<span class="code-keyword">true</span>"</span>&gt;
        &lt;property name=<span class="code-quote">"password"</span> value=<span class="code-quote">"${pica.password}"</span>&gt;&lt;/property&gt;
        &lt;property name=<span class="code-quote">"user"</span> value=<span class="code-quote">"${pica.user}"</span>&gt;&lt;/property&gt;
    &lt;/bean&gt;
   
    &lt;bean id=<span class="code-quote">"picaService"</span> class=<span class="code-quote">"net.gencat.ctti.canigo.connectors.pica.impl.PicaServiceWrapper"</span> singleton=<span class="code-quote">"<span class="code-keyword">false</span>"</span>&gt;
        &lt;property name=<span class="code-quote">"axisDefinition"</span> value=<span class="code-quote">"classpath:axis2client/"</span>&gt;&lt;/property&gt;
        &lt;property name=<span class="code-quote">"loggingService"</span> ref=<span class="code-quote">"loggingService"</span>&gt;&lt;/property&gt;
        &lt;property name=<span class="code-quote">"requeridor"</span> ref=<span class="code-quote">"requeridor"</span>&gt;&lt;/property&gt;
        &lt;property name=<span class="code-quote">"modalitats"</span>&gt;
            &lt;map&gt;
            &lt;/map&gt;
        &lt;/property&gt;
    &lt;/bean&gt;</pre>
</div></div><br clear="all" />
<br clear="all" />
Les propietats de connexió de la pica necessaries es defineixen a l'arxiu de propietats <b>src/main/resources/connectors/pica.properties</b> .</p>

<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Propietat <br clear="all" /> </th>
<th class='confluenceTh'> Requerit <br clear="all" /> </th>
<th class='confluenceTh'> Descripció <br clear="all" /> </th>
</tr>
<tr>
<td class='confluenceTd'> pica.user </td>
<td class='confluenceTd'> Sí </td>
<td class='confluenceTd'> Usuari del connector amb la PICA <br clear="all" /> </td>
</tr>
<tr>
<td class='confluenceTd'> pica.password </td>
<td class='confluenceTd'> Sí </td>
<td class='confluenceTd'> Password del connector amb la PICA <br clear="all" /> </td>
</tr>
<tr>
<td class='confluenceTd'> pica.urlPica </td>
<td class='confluenceTd'> Sí </td>
<td class='confluenceTd'> EndPoint del Servei Web de la PICA <br clear="all" />
per defecte: <a href="http://preproduccio.pica.gencat.intranet/pica_cataleg/AppJava/services/" title="Visit page outside Confluence">http://preproduccio.pica.gencat.intranet/pica_cataleg/AppJava/services/</a> <br clear="all" /> </td>
</tr>
</tbody></table>

<h4><a name="ServeideConnexi%C3%B3ambPSIS-Definici%C3%B3delserveidePsis"></a>Definició del servei de Psis</h4>

<p>S'ha de crear els bean PSISConnectorImpl en el contexte de Spring <b>src/main/resources/spring/canigo-services-psis.xml</b> com s'indica a continuació.
<br clear="all" />
<br clear="all" />
<div class="code"><div class="codeContent">
<pre class="code-java">&lt;bean id=<span class="code-quote">"psisService"</span> class=<span class="code-quote">"net.gencat.ctti.canigo.connectors.psis.impl.PSISConnectorImpl"</span> singleton=<span class="code-quote">"<span class="code-keyword">false</span>"</span>&gt;
	&lt;property name=<span class="code-quote">"picaService"</span> ref=<span class="code-quote">"picaService"</span>&gt;&lt;/property&gt;
	&lt;property name=<span class="code-quote">"loggingService"</span> ref=<span class="code-quote">"loggingService"</span>&gt;&lt;/property&gt;
	&lt;property name=<span class="code-quote">"urlPica"</span> value=<span class="code-quote">"${pica.urlPica}"</span> /&gt;
        &lt;property name=<span class="code-quote">"finalitat"</span> value=<span class="code-quote">"${psis.finalitat}"</span>/&gt;
&lt;/bean&gt;</pre>
</div></div><br clear="all" />
<br clear="all" />
També cal crear un arxiu de propietats (<b>src/main/resources/connectors/psis.properties</b>) per definir el valor de la finalitat de les crides al servei:</p>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Propietat <br clear="all" /> </th>
<th class='confluenceTh'> Requerit <br clear="all" /> </th>
<th class='confluenceTh'> Descripció <br clear="all" /> </th>
</tr>
<tr>
<td class='confluenceTd'> psis.finalitat </td>
<td class='confluenceTd'> Sí </td>
<td class='confluenceTd'> Finalitat de la crida al servei <br clear="all" /> </td>
</tr>
</tbody></table>

<h2><a name="ServeideConnexi%C3%B3ambPSIS-Utilitzaci%C3%B3delServei"></a>Utilització del Servei</h2>

<p>La instanciació, la preparació i la petició del servei es fa de manera transparent, de tal manera que el servei s'activa en el moment en que el bean "<em>PSISConnectorImpl</em>" es instanciat.</p>

<p>Per tant, la utilització del servei es realitza en la seva totalitat mitjançant la correcta parametrització de els objectes que constitueixen els missatges de les operacions de psis tant d'entrada com de sortida.</p>

<h1><a name="ServeideConnexi%C3%B3ambPSIS-Exemples"></a>Exemples</h1>

<p>Com exemple d'utilització del servei de connexió amb Psis s'inclou un exemple en el que es realitza la validació d'un certificat digital:
<br clear="all" />
<div class="code"><div class="codeContent">
<pre class="code-java">...
<span class="code-keyword">private</span> <span class="code-keyword">static</span> <span class="code-object">byte</span>[] certificatValid = getBytesFromInputStream(<span class="code-object">Thread</span>.currentThread().getContextClassLoader().
getResourceAsStream(<span class="code-quote">"certificatValid.cer"</span>));
    
<span class="code-keyword">public</span> void testValidarCertificat() <span class="code-keyword">throws</span> PSISException {
  PSISConnectorImpl psisConnector = (PSISConnectorImpl) beanFactory.getBean(<span class="code-quote">"psisService"</span>);
  assertNotNull(psisConnector);
    	
  ValCertSimpPICARequestDocument document = ValCertSimpPICARequestDocument.Factory.newInstance();
  ValCertSimpPICARequest peticioValidar = ValCertSimpPICARequest.Factory.newInstance();
    	
  peticioValidar.setCertificat(certificatValid);
   	
  document.setValCertSimpPICARequest(peticioValidar);
    	
  ValCertSimpPICAResponseDocument resposta = psisConnector.validarCertificat(document);
  assertEquals(<span class="code-quote">"VALID"</span>, resposta.getValCertSimpPICAResponse().getResultat());
}</pre>
</div></div><br clear="all" />
<br clear="all" />
<br clear="all" />
<br clear="all" />
<br clear="all" /></p>

				    
                    			    </td>
		    </tr>
	    </table>
	  
    </body>
</html>